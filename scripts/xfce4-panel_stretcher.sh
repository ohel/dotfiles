#!/bin/sh
# To prevent OLED burn-in, changes the xfce4-panel length at an interval.

interval=${1:-900}

# ((sin(-pi/2)..sin(pi/2)+1)/2)^2, 201 steps
sines="0.000000000 0.000000003 0.000000060 0.000000308 0.000000973 0.000002375 0.000004924 0.000009117 0.000015544 0.000024881 0.000037894 0.000055433 0.000078435 0.000107922 0.000145000 0.000190855 0.000246754 0.000314044 0.000394147 0.000488564 0.000598866 0.000726697 0.000873770 0.001041868 0.001232835 0.001448581 0.001691075 0.001962344 0.002264472 0.002599593 0.002969894 0.003377607 0.003825009 0.004314419 0.004848195 0.005428730 0.006058448 0.006739805 0.007475281 0.008267381 0.009118627 0.010031559 0.011008729 0.012052701 0.013166042 0.014351325 0.015611119 0.016947991 0.018364501 0.019863196 0.021446609 0.023117256 0.024877632 0.026730204 0.028677413 0.030721667 0.032865340 0.035110766 0.037460237 0.039915999 0.042480249 0.045155133 0.047942741 0.050845104 0.053864191 0.057001905 0.060260082 0.063640488 0.067144813 0.070774670 0.074531593 0.078417033 0.082432355 0.086578837 0.090857666 0.095269936 0.099816645 0.104498694 0.109316884 0.114271914 0.119364378 0.124594765 0.129963456 0.135470721 0.141116721 0.146901502 0.152824997 0.158887024 0.165087281 0.171425353 0.177900702 0.184512673 0.191260488 0.198143249 0.205159936 0.212309409 0.219590402 0.227001529 0.234541279 0.242208021 0.250000000 0.257915338 0.265952038 0.274107979 0.282380922 0.290768505 0.299268250 0.307877560 0.316593721 0.325413905 0.334335167 0.343354454 0.352468596 0.361674319 0.370968239 0.380346866 0.389806608 0.399343771 0.408954562 0.418635090 0.428381372 0.438189332 0.448054804 0.457973538 0.467941197 0.477953368 0.488005557 0.498093196 0.508211647 0.518356203 0.528522093 0.538704484 0.548898487 0.559099157 0.569301498 0.579500469 0.589690986 0.599867922 0.610026119 0.620160385 0.630265501 0.640336224 0.650367290 0.660353422 0.670289330 0.680169716 0.689989278 0.699742717 0.709424738 0.719030053 0.728553390 0.737989493 0.747333128 0.756579086 0.765722189 0.774757290 0.783679285 0.792483108 0.801163742 0.809716217 0.818135621 0.826417098 0.834555856 0.842547167 0.850386374 0.858068894 0.865590222 0.872945934 0.880131689 0.887143237 0.893976418 0.900627169 0.907091524 0.913365621 0.919445701 0.925328113 0.931009321 0.936485899 0.941754539 0.946812055 0.951655382 0.956281579 0.960687833 0.964871462 0.968829915 0.972560775 0.976061762 0.979330733 0.982365686 0.985164759 0.987726234 0.990048539 0.992130245 0.993970072 0.995566888 0.996919709 0.998027701 0.998890183 0.999506621 0.999876636 1.000000000"

while [ 1 ]
do
    old_length=$(xfconf-query -c xfce4-panel -p /panels/panel-0/length | cut -f 1 -d '.')
    new_length=$(shuf -i 75-100 -n 1)
    diff=$(expr $new_length - $old_length)

    step=1
    while [ $step -le 201 ]
    do
        length=$(echo "$old_length + $(echo $sines | cut -f $step -d ' ') * $diff" | bc)
        xfconf-query -c xfce4-panel -p /panels/panel-0/length -s $length
        sleep 0.0075
        step=$(expr $step + 1)
    done

    sleep $interval
done
